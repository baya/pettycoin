#include "helper_gateway_key.h"
#include <openssl/obj_mac.h>
#include "../protocol.h"

static const unsigned char gateway_key[] = {
	0x30,0x81,0xd3,0x02,0x01,0x01,0x04,0x20,0x1e,0xa1,0xa8,0xe9,
	0x26,0xb7,0x1d,0x88,0xe5,0xdc,0x04,0x71,0xc5,0x7e,0x1a,0x8d,
	0x0d,0xf7,0x02,0x0b,0x02,0x72,0x46,0x34,0x6a,0x68,0xc9,0x88,
	0x9e,0x85,0x82,0x56,0xa0,0x81,0x85,0x30,0x81,0x82,0x02,0x01,
	0x01,0x30,0x2c,0x06,0x07,0x2a,0x86,0x48,0xce,0x3d,0x01,0x01,
	0x02,0x21,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
	0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
	0xff,0xff,0xff,0xff,0xff,0xff,0xfe,0xff,0xff,0xfc,0x2f,0x30,
	0x06,0x04,0x01,0x00,0x04,0x01,0x07,0x04,0x21,0x02,0x79,0xbe,
	0x66,0x7e,0xf9,0xdc,0xbb,0xac,0x55,0xa0,0x62,0x95,0xce,0x87,
	0x0b,0x07,0x02,0x9b,0xfc,0xdb,0x2d,0xce,0x28,0xd9,0x59,0xf2,
	0x81,0x5b,0x16,0xf8,0x17,0x98,0x02,0x21,0x00,0xff,0xff,0xff,
	0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
	0xfe,0xba,0xae,0xdc,0xe6,0xaf,0x48,0xa0,0x3b,0xbf,0xd2,0x5e,
	0x8c,0xd0,0x36,0x41,0x41,0x02,0x01,0x01,0xa1,0x24,0x03,0x22,
	0x00,0x03,0xd1,0x31,0xc5,0x70,0xca,0xe2,0x35,0x78,0x4f,0xd7,
	0xd3,0xa3,0x40,0x3a,0x1c,0xbd,0x87,0xd8,0xab,0xc7,0x92,0xab,
	0x52,0x77,0xbe,0x0f,0xec,0xde,0xb2,0x08,0x06,0x4e
};

static void free_gateway_key(EC_KEY **p)
{
	EC_KEY_free(*p);
}

EC_KEY *helper_gateway_key(const tal_t *ctx)
{
	const unsigned char *p = gateway_key;
	EC_KEY *priv = EC_KEY_new_by_curve_name(NID_secp256k1);
	EC_KEY **ptr;

	if (!d2i_ECPrivateKey(&priv, &p, sizeof(gateway_key)))
		abort();

	/* We *always* used compressed form keys. */
	EC_KEY_set_conv_form(priv, POINT_CONVERSION_COMPRESSED);

	/* To get tal to clean it up... */
	ptr = tal(ctx, EC_KEY *);
	*ptr = priv;
	tal_add_destructor(ptr, free_gateway_key);

	return priv;
}

static struct protocol_pubkey gateway_pubkey = {
	.key = { 0x03,0xd1,0x31,0xc5,0x70,0xca,0xe2,0x35,0x78,0x4f,0xd7,
		 0xd3,0xa3,0x40,0x3a,0x1c,0xbd,0x87,0xd8,0xab,0xc7,0x92,0xab,
		 0x52,0x77,0xbe,0x0f,0xec,0xde,0xb2,0x08,0x06,0x4e }
};

const struct protocol_pubkey *helper_gateway_public_key(void)
{
	return &gateway_pubkey;
}
